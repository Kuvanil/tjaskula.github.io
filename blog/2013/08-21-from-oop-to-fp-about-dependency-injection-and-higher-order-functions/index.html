
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Tomasz Jaskula's blog</title>
    <link rel="stylesheet" href="http://jaskula.fr//stylesheets/bootstrap/less/bootstrap.css">
    <link rel="stylesheet" href="http://jaskula.fr//stylesheets/pygment_trac.css">
    <link rel="shortcut icon" href="http://jaskula.fr//favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="description" content="How the OOP concept of dependency injection can be achieved in functional programming with F#" />
    <meta name="author" content="Tomasz Jaskuła" />
    <meta name="copyright" content="Tomasz Jaskuła 2015" />

    <!-- Twitter cards -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:creator" content="@tjaskula">
    <meta name="twitter:title" content="From OOP to FP : About dependency injection and higher-order functions">
    <meta name="twitter:description" content="How the OOP concept of dependency injection can be achieved in functional programming with F#">
    
    <!-- End Twitter cards -->

    <link rel="alternate" type="application/rss+xml" title="Tomasz Jaskula's blog" href="http://jaskula.fr/rss.xml" />

      <!--<script>
          (function(d) {
              var config = {
                          kitId: 'xfo7ulp',
                          scriptTimeout: 3000
                      },
                      h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='//use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
          })(document);
      </script>-->
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!-- FSharp.Formatting Styles --> 
    <link rel="stylesheet" type="text/css" media="screen" href="http://jaskula.fr//fsharp.formatting/tooltips.css" />
  	<script type="text/javascript" src="http://jaskula.fr//fsharp.formatting/tooltips.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-58152976-1', 'auto');
        ga('send', 'pageview');

    </script>

  </head>
  <body>

	  <header>

        <div class="navbar-header">
            <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <h1><a class="" href="http://jaskula.fr//index.html">Tomasz Jaskula's blog</a>
                <small>Improve signal, reduce noise = use F#</small>
            </h1>
        </div>

        <nav class="collapse navbar-collapse bs-navbar-collapse">
          <ul class="nav navbar-nav">
              <li>
                  <a href="http://jaskula.fr//blog/">Blog</a>
              </li>
              <li>
                  <A HREF="http://jaskula.fr//talks/">Talks</A>
              </li>
              <!-- <li class="active">
                    <a href="http://jaskula.fr//talks/">Talks</a>
              </li> -->
          </ul>
        </nav>

    </header>

    <div class="container">
      <div class="row">
        <main class="col-lg-8">
              
<h1>From OOP to FP : About dependency injection and higher-order functions</h1>

<div class="row">
<div class="medium-8 columns">
<p>This is the next part of the series "My 2 weeks trip from OOP to FP"</p>
</div>
</div>
<!-- more -->
<p>To keep track of previous posts, here's a little toc:</p>
<ul>
<li><a href="http://jaskula.fr//blog/2013/08-14-my-2-weeks-trip-from-oop-to-fp-with-f/index.html">My 2 weeks trip from OOP to FP with F#</a></li>
<li><a href="http://jaskula.fr//blog/2013/08-16-sharing-code-between-c-and-f/index.html">Sharing code between C# and F#</a></li>
</ul>
<p>I don't know if this is the case for everybody but when you start to learn a new language you try to think about all the things that you've learnt with a language you use on the daily basis. You would like to apply all the design patterns and techniques that you've always used with success (or not). This is not always possible because <strong>design patterns are not universal</strong> for every language as you may think of it. <strong>Design patterns are tied to some paradigm</strong> and thus only applicable in the context of that paradigm. In short, the design patterns are only valid in the context of the paradigm followed by the given language. I'm talking here about Object Oriented Paradigm (OOP) and Functional Paradigm (FP). Furthermore, you can read about this in the <a href="http://en.wikipedia.org/wiki/Software_design_pattern">wikipedia definition</a> as well:</p>
<blockquote>
<p>...Object-oriented design patterns typically show relationships and interactions between classes or objects, without specifying the final application classes or objects that are involved. Patterns that imply <strong>object-orientation</strong> or more generally mutable state, <strong>are not as applicable in functional programming languages...</strong></p>
</blockquote>
<p>The same rule applies to some of the <a href="http://en.wikipedia.org/wiki/SOLID_(object-oriented_design)">S.O.L.I.D.</a> principles. While the application of the SRP may be easily transposed to FP (you just have to replace the word "class" by "function" in the principle's description; "a class should have only a single responsibility.", it's not the case for other principles.</p>
<p>I would like to focus here on a pattern called <strong>"Dependency Injection"</strong> that is one method of achieving <a href="http://en.wikipedia.org/wiki/Dependency_inversion_principle">DIP</a> in SOLID. Before asking why I want to focus on that topic in the context of F# let's recall what DI allows (<a href="http://en.wikipedia.org/wiki/Dependency_injection">from wiki</a>):</p>
<blockquote>
<p>Dependency injection is a software design pattern that allows the <strong>removal of hard-coded dependencies</strong> and <strong>makes it possible to change them</strong>, whether at run-time or compile-time...</p>
</blockquote>
<p>Reading on further:</p>
<blockquote>
<p>...This can be used, for example, ...or to choose stubs or mock objects in test environments vs. real objects in production environments...</p>
</blockquote>
<p>Well, now we have a big picture of the benefits of using a Dependency Injection pattern in OOP language like C#. It's so popular these days, that when a team is starting a new project you have to rather justify why you don't want to use DI rather than why you're using it. Folks are even not asking themselves if they need it at all. They just pick up an DI framework, throw it into the project and continue without even thinking about.</p>
<p>But what's important when you're starting to use a functional programing language like F# is that you would like to have the same benefits that offer DI for OO language:</p>
<ul>
<li>Decoupling by removing hard coded dependencies</li>
</ul>
<p>Before going further let's recall the context why I'm talking about.</p>
<h2>Context</h2>
<p>In my previous post "<a href="http://jaskula.fr//blog/2013/08-16-sharing-code-between-c-and-f/index.html">Sharing code between C# and F#</a>" I've touched upon the architecture I set up for my C# and F# project. Comparing both of them we see clearly that the MVC (C#) project follows the Dependency Inversion principle and the Calc Engine (F#) part does not. In this post we'll focus on the F# part which looks like that:</p>
<p><img src="img/FSharpArchitecture.PNG" alt="F# architecture and module organization" /></p>
<p>It seems like this is the classic layered architecture used 10 years ago. But this is straightforward and seemed to me appropriate to start with F#. (I would be grateful to all F# experts to point me on the right tracks if this is what should be done differently). This is closely related to the nature of the relation that dependencies has in OO and Functional languages.</p>
<h2>Composition happens on different levels</h2>
<p>As I said, one way of achieving decoupling is getting rid of hard coded dependencies and to depend on abstractions. In OO languages the composition is more "coarse" grained as it happens on the object level. Objects are composed into graphs and relations between objects and graphs are dependencies. That's why respecting the SRP principle is very important because one object depends on another because of the functionality it can provide to the calling object. If the objects that we depend on, carry more functionalities, it may be also involved in dependencies with other objects which makes the dependency graph more complicated.</p>
<p>In F# the composition happens at the function level. For me it's a "fine" grained composition because well written functions have generally a single responsibility. Comparing to C# is like we would like to compose methods and not objects (I'm not saying that a method in C# == function in F#).</p>
<p>Knowing these two facts we may ask ourselves if "Dependency Injection" pattern makes any sense when related to the functional programming language. <strong>Dependency Injection is a pattern related to the OOP</strong> and it's related to component composition which in that case are <strong>"objects"</strong>. So I can surely state that:</p>
<h2>Dependency injection is a nonsense in FP</h2>
<p>You may say that you've been reading through all this post just to discover the statement above which is obvious for everybody. But I want to stress that when you come to the new programming paradigm you'd be better living all your habits and patterns outside. Forgot about them and try to learn from the beginning. You'll find ways to achieve what you want using patterns related to the given context.</p>
<h2>Achieving decoupling in F#</h2>
<p>If you look at the schema above, you will notice that I'm dealing here with Infrastructure Layer that deals with database access. I would like to not have a hard dependency on because when I'm testing my Facade layer I don't want to deal with a real database and Windows Azure storage. I'm a noob in F# programming but what I've learnt until now, allows me to think that I could use a higher-order functions and partial application to achieve a kind of decoupling.</p>
<h3>Higher-order functions and partial application</h3>
<p>To put it simply, <strong>Higher-order function</strong> refers to a function that takes a function as a parameter or returns it as a result. Higher-order functions are a way to write generic functional code, which means that the same code can be reused for many similar but distinct purposes.</p>
<p>However the concept of partial application it's easier to explain with an example. Let's declare a function that takes 2 parameters and returns the sum of both:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">&gt;</span> <span class="k">let</span> <span class="i">add</span> <span class="i">a</span> <span class="i">b</span> <span class="o">=</span> <span class="i">a</span> <span class="o">+</span> <span class="i">b</span>;;
<span class="k">val</span> <span class="i">add</span> <span class="o">:</span> <span class="i">a</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">int</span> <span class="k">-&gt;</span> <span class="i">b</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs1', 2)" onmouseover="showTip(event, 'fs1', 2)" class="i">int</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs1', 3)" onmouseover="showTip(event, 'fs1', 3)" class="i">int</span>
</code></pre></td>
</tr>
</table>
<p>The function signature <code>a:int -&gt; b:int -&gt; int</code> indicates exactly that case (two integers as parameter and an integer as return value). In F#, there is a concept called <strong>"Partial application"</strong> that allows the caller to no pass every argument to the function. What’s happens in that case is that F# creates another function. Let’s see another example:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">&gt;</span> <span class="k">let</span> <span class="i">add10</span> <span class="o">=</span> <span class="i">add</span> <span class="n">10</span>;;
<span class="k">val</span> <span class="i">add10</span> <span class="o">:</span> (<span onmouseout="hideTip(event, 'fs1', 4)" onmouseover="showTip(event, 'fs1', 4)" class="i">int</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs1', 5)" onmouseover="showTip(event, 'fs1', 5)" class="i">int</span>)
</code></pre></td>
</tr>
</table>
<p>What happens is that we define a function called <code>add10</code> which adds 10 to whatever the second argument will be. This function is the result of a partial application on the function <code>add</code> because we have passed only one argument instead of two. The signature just shows it <code>(int -&gt; int)</code>. This concept is very powerful, because we can just call <code>add10</code> function in some later point in time when the second parameter will be available. So now we can call the <code>add10</code> function in this way to obtain a result:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">&gt;</span> <span class="i">add10</span> <span class="n">12</span>;;
<span class="k">val</span> <span class="i">it</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs1', 6)" onmouseover="showTip(event, 'fs1', 6)" class="i">int</span> <span class="o">=</span> <span class="n">22</span>
</code></pre></td>
</tr>
</table>
<p>We call the function passing in 12 and the results is of 22 which is the correct (10 + 12 = 22). The partial application is also a concept broadly used with pipelining.</p>
<p>But how this can be useful with decoupling between layers?</p>
<p>Let's check how Dependency Injection is done in C#:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp"><span class="k">public</span> <span class="k">class</span> Caluclator <span class="o">:</span> ICaluclator
{
  <span class="k">private</span> <span class="k">readonly</span> IApplicantRepository _applicantRepository;
  <span class="k">private</span> <span class="k">readonly</span> IAttributeRepository _attributeRepository;

  <span class="k">public</span> Caluclator(IApplicantRepository applicantRepository, 
            IAttributeRepository attributeRepository)
  {
    <span class="k">if</span> (applicantRepository <span class="o">=</span><span class="o">=</span> <span class="k">null</span>) 
      <span class="k">throw</span> <span class="k">new</span> ArgumentNullException(<span class="s">"applicantRepository"</span>);
    <span class="k">if</span> (attributeRepository <span class="o">=</span><span class="o">=</span> <span class="k">null</span>) 
      <span class="k">throw</span> <span class="k">new</span> ArgumentNullException(<span class="s">"attributeRepository"</span>);

    _applicantRepository <span class="o">=</span> applicantRepository;
    _attributeRepository <span class="o">=</span> attributeRepository;
  }

  <span class="k">public</span> IEnumerable&lt;<span class="k">string</span>&gt; Calculate(<span class="k">int</span> itemId)
  {
    <span class="k">var</span> attributes <span class="o">=</span> _attributeRepository
              .GetAttributesForItem(itemId);
    <span class="k">var</span> applicants <span class="o">=</span> _applicantRepository
              .GetApplicantsByAttributes(attributes);

    <span class="c">// do some calculation on applicants.</span>

    <span class="k">return</span> applicants.Select(x <span class="o">=</span><span class="o">&gt;</span> x.Name);
  }
}
</code></pre></td></tr></table>
<p>The code is quite straightforward and I don't think it needs much explanation. The dependencies are passed to the class' constructor and used when a method <code>Calculate</code> is invoked. What's interesting, is that if we want to test the <code>Calculate</code> method, we have to create an instance of our calculator passing in to the constructor faked dependencies.</p>
<p>It's something that I tried to achieve in my F# implementation. If you look at the schema above you'll notice that it is interesting to keep decoupling for the Facade and Domain layers. Let's focus on the Facade layer as it has a dependency on Infrastructure layer and the persistence.</p>
<p>First of all let's define our Calculate method:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">calculate</span> <span class="i">getApplicantsFunc</span> <span class="i">getAttributsFunc</span> <span class="i">itemId</span> <span class="o">=</span>
    <span class="k">let</span> <span class="i">attributes</span> <span class="o">=</span> <span class="i">getAttributsFunc</span> <span class="i">itemId</span>
    <span class="k">let</span> <span class="i">applicants</span> <span class="o">=</span> <span class="i">getApplicantsFunc</span> <span class="i">attributes</span>
    <span class="i">applicants</span>
</code></pre></td>
</tr>
</table>
<p>What we have here is a function taking as parameters two functions and an <code>itemId</code>. The signature of the functions is as follows: <code>(('a -&gt; 'b) -&gt; ('c -&gt; 'a) -&gt; 'c -&gt; 'b)</code>.</p>
<p>Then we can define our calculator function like this:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">calculator</span> <span class="i">getApplicantsFunc</span> <span class="i">getAttributsFunc</span> <span class="o">=</span> 
	<span class="i">calculate</span> <span class="i">getApplicantsFunc</span> <span class="i">getAttributsFunc</span>
</code></pre></td>
</tr>
</table>
<p>The <code>calculator</code> function is derived from the calculate function because we just pass a two parameters instead of three. We don't pass <code>itemId</code> so the compiler concludes that calculator must be also a function. This is a partial application at play. Let's look on the calculator function signature : <code>('a -&gt; 'b) -&gt; ('c -&gt; 'a) -&gt; ('c -&gt; 'b)</code></p>
<p>We notice that the last parameter which is a return value indicates that it's a function. What's interesting is that we are declaring our <code>calculator</code> function the same way as we've declared our <code>Calculator</code> class in C#, passing in two dependencies that we want to mock for unit testing for example.</p>
<p>All these definitions I've wrapped inside a kind of Facade type that will be shared with C# code. It looks like that:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">Calculator</span>() <span class="o">=</span> 

    <span class="k">let</span> <span class="i">calculate</span> <span class="i">getApplicantsFunc</span> <span class="i">getAttributsFunc</span> <span class="i">itemId</span> <span class="o">=</span>
        <span class="k">let</span> <span class="i">attributes</span> <span class="o">=</span> <span class="i">getAttributsFunc</span> <span class="i">itemId</span>
        <span class="k">let</span> <span class="i">applicants</span> <span class="o">=</span> <span class="i">getApplicantsFunc</span> <span class="i">attributes</span>
        <span class="i">applicants</span>

    <span class="k">member</span> <span class="i">v</span><span class="o">.</span><span class="i">calculator</span> <span class="i">getApplicantsFunc</span> <span class="i">getAttributsFunc</span> <span class="o">=</span> 
    			<span class="i">calculate</span> <span class="i">getApplicantsFunc</span> <span class="i">getAttributsFunc</span>

    <span class="k">interface</span> <span class="i">ICalculator</span> <span class="k">with</span>
        <span class="k">member</span> <span class="i">v</span><span class="o">.</span><span class="i">Calculate</span> <span class="i">itemId</span> <span class="o">=</span>
            <span class="i">v</span><span class="o">.</span><span class="i">calculator</span> <span class="i">getApplicantFromDb</span> <span class="i">getAttributesFromDb</span> <span class="i">itemId</span>
</code></pre></td>
</tr>
</table>
<p>You notice that the type <code>Calculator()</code> implements an interface <code>ICalculator</code> shared from C# code. This interface defines one method (function) <code>Calculate</code> where we call our calculator passing in two functions from the F# persistance layer <code>getApplicantFromDb</code> and <code>getAttributesFromDb</code> and also an <code>itemId</code>. The method (function) <code>Calculate</code> has a hard dependency on theses two methods from persistence layer but it doesn't matter because it's not at that level that I want to test. This is only here for C# sharing and will be only visible from C#.</p>
<p>What I want to test is my internal calculator defined like this:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">member</span> <span class="i">v</span><span class="o">.</span><span class="i">calculator</span> <span class="i">getApplicantsFunc</span> <span class="i">getAttributsFunc</span> <span class="o">=</span> 
		<span class="i">calculate</span> <span class="i">getApplicantsFunc</span> <span class="i">getAttributsFunc</span>
</code></pre></td>
</tr>
</table>
<p>Now you can see that all we want is to have a <code>calculator</code> function with different kind of dependencies. Let's see how it works. Before I'll show you to possible of implementation for the dependencies.</p>
<p>Simulation of the dependencies of the real world:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">getAttributesFromDb</span> <span class="i">itemId</span> <span class="o">=</span>
	[<span class="i">itemId</span><span class="o">..</span>(<span class="i">itemId</span> <span class="o">+</span> <span class="n">10</span>)]

<span class="k">let</span> <span class="i">getApplicantFromDb</span> <span class="i">attributes</span> <span class="o">=</span>
    <span class="i">attributes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs2', 7)" onmouseover="showTip(event, 'fs2', 7)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs3', 8)" onmouseover="showTip(event, 'fs3', 8)" class="i">map</span> (<span class="k">fun</span> <span class="i">i</span> <span class="k">-&gt;</span> <span class="s">&quot;applicant&quot;</span> <span class="o">+</span> <span class="i">i</span><span class="o">.</span><span class="i">ToString</span>())
</code></pre></td>
</tr>
</table>
<p>You have to imagine that these two functions access to the real database to get data. Here I've just declared some data for test.</p>
<p>We can also have a faked functions like that:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">getAttributesFromDbFake</span> <span class="i">itemId</span> <span class="o">=</span>
	[<span class="i">itemId</span><span class="o">..</span>(<span class="i">itemId</span> <span class="o">+</span> <span class="n">100</span>)]

<span class="k">let</span> <span class="i">getApplicantFromDbFake</span> <span class="i">attributes</span> <span class="o">=</span>
    <span class="i">attributes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs2', 9)" onmouseover="showTip(event, 'fs2', 9)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs3', 10)" onmouseover="showTip(event, 'fs3', 10)" class="i">map</span> (<span class="k">fun</span> <span class="i">i</span> <span class="k">-&gt;</span> <span class="s">&quot;stubedApplicant&quot;</span> <span class="o">+</span> <span class="i">i</span><span class="o">.</span><span class="i">ToString</span>())
</code></pre></td>
</tr>
</table>
<p>It's quite similar to the previous except that I named it with a prefix suffix Fake and the 100 is added to the generating list instead of 10 like in the previous declaration. But it's not the point. Let's say that these are the fake functions for testing.</p>
<p>Now I can check how my calculator behaves with a real implementation in F# Interactive:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">&gt;</span> <span class="k">let</span> <span class="i">calc</span> <span class="o">=</span> <span class="k">new</span> <span class="i">Facade</span><span class="o">.</span><span class="i">Calculator</span>();;

<span class="k">val</span> <span class="i">calc</span> <span class="o">:</span> <span class="i">Facade</span><span class="o">.</span><span class="i">Calculator</span>

<span class="o">&gt;</span> <span class="k">let</span> <span class="i">calculator</span> <span class="o">=</span> <span class="i">calc</span><span class="o">.</span><span class="i">calculator</span> <span class="i">getApplicantFromDb</span> <span class="i">getAttributesFromDb</span>;;

<span class="k">val</span> <span class="i">calculator</span> <span class="o">:</span> (<span onmouseout="hideTip(event, 'fs1', 11)" onmouseover="showTip(event, 'fs1', 11)" class="i">int</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 12)" onmouseover="showTip(event, 'fs4', 12)" class="i">string</span> <span onmouseout="hideTip(event, 'fs5', 13)" onmouseover="showTip(event, 'fs5', 13)" class="i">list</span>)

<span class="o">&gt;</span> <span class="i">calculator</span> <span class="n">10</span>;;
<span class="k">val</span> <span class="i">it</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs4', 14)" onmouseover="showTip(event, 'fs4', 14)" class="i">string</span> <span onmouseout="hideTip(event, 'fs5', 15)" onmouseover="showTip(event, 'fs5', 15)" class="i">list</span> <span class="o">=</span>
  [<span class="s">&quot;applicant10&quot;</span>; <span class="s">&quot;applicant11&quot;</span>; <span class="s">&quot;applicant12&quot;</span>; <span class="s">&quot;applicant13&quot;</span>; <span class="s">&quot;applicant14&quot;</span>;
   <span class="s">&quot;applicant15&quot;</span>; <span class="s">&quot;applicant16&quot;</span>; <span class="s">&quot;applicant17&quot;</span>; <span class="s">&quot;applicant18&quot;</span>; <span class="s">&quot;applicant19&quot;</span>;
   <span class="s">&quot;applicant20&quot;</span>]
</code></pre></td>
</tr>
</table>
<p>As you can see the result is taken from the "real" implementation of my functions. But if I want to test my calculator implementation I could pass in a fake functions:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">&gt;</span> <span class="k">let</span> <span class="i">calculator</span> <span class="o">=</span> <span class="i">calc</span><span class="o">.</span><span class="i">calculator</span> <span class="i">getApplicantFromDbFake</span> <span class="i">getAttributesFromDbFake</span>;;

<span class="k">val</span> <span class="i">calculator</span> <span class="o">:</span> (<span onmouseout="hideTip(event, 'fs1', 16)" onmouseover="showTip(event, 'fs1', 16)" class="i">int</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 17)" onmouseover="showTip(event, 'fs4', 17)" class="i">string</span> <span onmouseout="hideTip(event, 'fs5', 18)" onmouseover="showTip(event, 'fs5', 18)" class="i">list</span>)

<span class="o">&gt;</span> <span class="i">calculator</span> <span class="n">10</span>;;
<span class="k">val</span> <span class="i">it</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs4', 19)" onmouseover="showTip(event, 'fs4', 19)" class="i">string</span> <span onmouseout="hideTip(event, 'fs5', 20)" onmouseover="showTip(event, 'fs5', 20)" class="i">list</span> <span class="o">=</span>
  [<span class="s">&quot;stubedApplicant10&quot;</span>; <span class="s">&quot;stubedApplicant11&quot;</span>; <span class="s">&quot;stubedApplicant12&quot;</span>;
   <span class="s">&quot;stubedApplicant13&quot;</span>; <span class="s">&quot;stubedApplicant14&quot;</span>; <span class="s">&quot;stubedApplicant15&quot;</span>;
   <span class="s">&quot;stubedApplicant16&quot;</span>; <span class="s">&quot;stubedApplicant17&quot;</span>; <span class="s">&quot;stubedApplicant18&quot;</span>;
   <span class="s">&quot;stubedApplicant19&quot;</span>; <span class="s">&quot;stubedApplicant20&quot;</span>; <span class="s">&quot;stubedApplicant21&quot;</span>;
   <span class="s">&quot;stubedApplicant22&quot;</span>; <span class="s">&quot;stubedApplicant23&quot;</span>; <span class="s">&quot;stubedApplicant24&quot;</span>;
   <span class="s">&quot;stubedApplicant25&quot;</span>; <span class="s">&quot;stubedApplicant26&quot;</span>; <span class="s">&quot;stubedApplicant27&quot;</span>;
   <span class="s">&quot;stubedApplicant28&quot;</span>; <span class="s">&quot;stubedApplicant29&quot;</span>; <span class="s">&quot;stubedApplicant30&quot;</span>;
   <span class="s">&quot;stubedApplicant31&quot;</span>; <span class="s">&quot;stubedApplicant32&quot;</span>; <span class="s">&quot;stubedApplicant33&quot;</span>;
   <span class="s">&quot;stubedApplicant34&quot;</span>; <span class="s">&quot;stubedApplicant35&quot;</span>; <span class="s">&quot;stubedApplicant36&quot;</span>;
   <span class="s">&quot;stubedApplicant37&quot;</span>; <span class="s">&quot;stubedApplicant38&quot;</span>; <span class="s">&quot;stubedApplicant39&quot;</span>;
   <span class="s">&quot;stubedApplicant40&quot;</span>; <span class="s">&quot;stubedApplicant41&quot;</span>; <span class="s">&quot;stubedApplicant42&quot;</span>;
   <span class="s">&quot;stubedApplicant43&quot;</span>; <span class="s">&quot;stubedApplicant44&quot;</span>; <span class="s">&quot;stubedApplicant45&quot;</span>;
   <span class="s">&quot;stubedApplicant46&quot;</span>; <span class="s">&quot;stubedApplicant47&quot;</span>; <span class="s">&quot;stubedApplicant48&quot;</span>;
   <span class="s">&quot;stubedApplicant49&quot;</span>; <span class="s">&quot;stubedApplicant50&quot;</span>; <span class="s">&quot;stubedApplicant51&quot;</span>;
   <span class="s">&quot;stubedApplicant52&quot;</span>; <span class="s">&quot;stubedApplicant53&quot;</span>; <span class="s">&quot;stubedApplicant54&quot;</span>;
   <span class="s">&quot;stubedApplicant55&quot;</span>; <span class="s">&quot;stubedApplicant56&quot;</span>; <span class="s">&quot;stubedApplicant57&quot;</span>;
   <span class="s">&quot;stubedApplicant58&quot;</span>; <span class="s">&quot;stubedApplicant59&quot;</span>; <span class="s">&quot;stubedApplicant60&quot;</span>;
   <span class="s">&quot;stubedApplicant61&quot;</span>; <span class="s">&quot;stubedApplicant62&quot;</span>; <span class="s">&quot;stubedApplicant63&quot;</span>;
   <span class="s">&quot;stubedApplicant64&quot;</span>; <span class="s">&quot;stubedApplicant65&quot;</span>; <span class="s">&quot;stubedApplicant66&quot;</span>;
   <span class="s">&quot;stubedApplicant67&quot;</span>; <span class="s">&quot;stubedApplicant68&quot;</span>; <span class="s">&quot;stubedApplicant69&quot;</span>;
   <span class="s">&quot;stubedApplicant70&quot;</span>; <span class="s">&quot;stubedApplicant71&quot;</span>; <span class="s">&quot;stubedApplicant72&quot;</span>;
   <span class="s">&quot;stubedApplicant73&quot;</span>; <span class="s">&quot;stubedApplicant74&quot;</span>; <span class="s">&quot;stubedApplicant75&quot;</span>;
   <span class="s">&quot;stubedApplicant76&quot;</span>; <span class="s">&quot;stubedApplicant77&quot;</span>; <span class="s">&quot;stubedApplicant78&quot;</span>;
   <span class="s">&quot;stubedApplicant79&quot;</span>; <span class="s">&quot;stubedApplicant80&quot;</span>; <span class="s">&quot;stubedApplicant81&quot;</span>;
   <span class="s">&quot;stubedApplicant82&quot;</span>; <span class="s">&quot;stubedApplicant83&quot;</span>; <span class="s">&quot;stubedApplicant84&quot;</span>;
   <span class="s">&quot;stubedApplicant85&quot;</span>; <span class="s">&quot;stubedApplicant86&quot;</span>; <span class="s">&quot;stubedApplicant87&quot;</span>;
   <span class="s">&quot;stubedApplicant88&quot;</span>; <span class="s">&quot;stubedApplicant89&quot;</span>; <span class="s">&quot;stubedApplicant90&quot;</span>;
   <span class="s">&quot;stubedApplicant91&quot;</span>; <span class="s">&quot;stubedApplicant92&quot;</span>; <span class="s">&quot;stubedApplicant93&quot;</span>;
   <span class="s">&quot;stubedApplicant94&quot;</span>; <span class="s">&quot;stubedApplicant95&quot;</span>; <span class="s">&quot;stubedApplicant96&quot;</span>;
   <span class="s">&quot;stubedApplicant97&quot;</span>; <span class="s">&quot;stubedApplicant98&quot;</span>; <span class="s">&quot;stubedApplicant99&quot;</span>;
   <span class="s">&quot;stubedApplicant100&quot;</span>; <span class="s">&quot;stubedApplicant101&quot;</span>; <span class="s">&quot;stubedApplicant102&quot;</span>;
   <span class="s">&quot;stubedApplicant103&quot;</span>; <span class="s">&quot;stubedApplicant104&quot;</span>; <span class="s">&quot;stubedApplicant105&quot;</span>;
   <span class="s">&quot;stubedApplicant106&quot;</span>; <span class="s">&quot;stubedApplicant107&quot;</span>; <span class="s">&quot;stubedApplicant108&quot;</span>;
   <span class="s">&quot;stubedApplicant109&quot;</span>; <span class="o">..</span><span class="o">.</span>]
</code></pre></td>
</tr>
</table>
<p>You can see that the result is quite different and comes from stubbed functions. We've achieved the same functionality that we are used to in OOP world with DIP and Dependency Injection.</p>
<h2>In closing</h2>
<p>The dependency injection pattern is much more powerful in OOP that what I've described here. Lifetime-managment of dependencies, graph composition and so on. What we were interested in is the decoupling that adoption of that pattern brings to the table. Moreover, lifetime-managment of dependencies is not necessary in F# because anyway all is immutable and everything gets it's own copy so we don't need to worry about this aspect. Graph composition is not something very useful in F# either. We've just simulated similar concept as dependency injection by using higher-order functions and partial application.</p>
<p>As disclaimer I would say that I'm still exploring and learning F#. So for a really experienced F# developer it might seem totally incorrect what I've written here. I would be really grateful to here your feedback and if I'm not correct I'll make an update to my post. So don't take all what I'm saying here as a standard or a way for doing things. For me it worked well but I would be very happy to hear how others do.</p>

<div class="tip" id="fs1">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>
<div class="tip" id="fs2">Multiple items<br />module List<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type List&lt;&#39;T&gt; =<br />&#160;&#160;| ( [] )<br />&#160;&#160;| ( :: ) of Head: &#39;T * Tail: &#39;T list<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;member GetSlice : startIndex:int option * endIndex:int option -&gt; &#39;T list<br />&#160;&#160;member Head : &#39;T<br />&#160;&#160;member IsEmpty : bool<br />&#160;&#160;member Item : index:int -&gt; &#39;T with get<br />&#160;&#160;member Length : int<br />&#160;&#160;member Tail : &#39;T list<br />&#160;&#160;static member Cons : head:&#39;T * tail:&#39;T list -&gt; &#39;T list<br />&#160;&#160;static member Empty : &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List&lt;_&gt;</div>
<div class="tip" id="fs3">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; list:&#39;T list -&gt; &#39;U list<br /><br />Full name: Microsoft.FSharp.Collections.List.map</div>
<div class="tip" id="fs4">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = System.String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs5">type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>


<!-- AddThis -->

    <div class="addthis_sharing_toolbox"></div>
    <!-- Go to www.addthis.com/dashboard to customize your tools -->
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-54bed07b3003b40e"></script>


<!-- END AddThis -->


<!-- Disqus -->
    <div id="disqus_thread"></div>
    <script>

    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    
    var disqus_config = function () {

    this.page.url = '';  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    this.page.title = 'From OOP to FP : About dependency injection and higher-order functions';
    };
    
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//tjaskula.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<!-- Disqus END -->
        </main>
        <aside class="col-lg-4">
              <article>
                <img class="img-responsive img-circle" src="http://jaskula.fr//img/aside-face200.jpg" />
                <div class="aside-text">
                    <blockquote class="small">
                        <p><cite>Welcome to my blog! F# and functional programming it's what I'm interested in and passionate about at the moment. However, software architecture, software craftsmanship, Domain Driven Design are also topics dear to my heart. So stay tuned! There is more to come...</cite></p>
                          <footer>Tomasz Jaskuła</footer>
                    </blockquote>
                </div>
                <div class="social">
                    <a href="https://www.facebook.com/thomas.jaskula" title="facebook"><img src="http://jaskula.fr//img/facebook.jpg" /></a>
                    <a href="https://github.com/tjaskula" title="github"><img src="http://jaskula.fr//img/github.jpg" /></a>
                    <a href="https://plus.google.com/u/1/106268061202265370189/about" title="google"><img src="http://jaskula.fr//img/google.jpg" /></a>
                    <a href="https://twitter.com/tjaskula" title="twitter"><img src="http://jaskula.fr//img/twitter.jpg" /></a>
                    <a href="http://jaskula.fr//rss.xml" title="rss"><img src="http://jaskula.fr//img/rss.jpg" /></a>
                </div>
            </article>
              <article>
                   <h2>Recent posts</h2>

                      <ul class="articles-list">
                              <li>
                                  <h3><a href="http://jaskula.fr//blog/2016/12-19-data-structures-and-algorithms-helping-santa-claus-find-his-road-to-san-francisco/index.html">Data structures and algorithms - helping Santa Claus find his road to San Francisco</a>
                                      <span>    <time datetime="2016-12-19T10:35:01" pubdate data-updated="true">Dec 19, 2016</time>
</span>
                                  </h3>
                              </li>
                              <li>
                                  <h3><a href="http://jaskula.fr//blog/2016/11-09-back-to-basics-algorithms-finding-the-max-pairwise-product/index.html">Back to basics: Algorithms - finding the max pairwise product</a>
                                      <span>    <time datetime="2016-11-09T08:05:56" pubdate data-updated="true">Nov 9, 2016</time>
</span>
                                  </h3>
                              </li>
                              <li>
                                  <h3><a href="http://jaskula.fr//blog/2015/12-02-data-science-tools-in-f-through-univariante-linear-regression/index.html">Data Science tools in F# through univariante linear regression</a>
                                      <span>    <time datetime="2015-12-02T03:18:24" pubdate data-updated="true">Dec 2, 2015</time>
</span>
                                  </h3>
                              </li>
                              <li>
                                  <h3><a href="http://jaskula.fr//blog/2015/08-14-integrating-ndepend-with-teamcity-9/index.html">Integrating NDepend with TeamCity 9</a>
                                      <span>    <time datetime="2015-08-14T00:10:22" pubdate data-updated="true">Aug 14, 2015</time>
</span>
                                  </h3>
                              </li>
                              <li>
                                  <h3><a href="http://jaskula.fr//blog/2015/01-21-beginners-quick-guide-to-setup-fsblog-and-start-to-blog-in-5-minutes/index.html">Beginners quick guide to setup FsBlog and start to blog in 5 minutes</a>
                                      <span>    <time datetime="2015-01-21T11:55:09" pubdate data-updated="true">Jan 21, 2015</time>
</span>
                                  </h3>
                              </li>
                      </ul>

                  <h4>Blog tags</h4>
                  <p>

                    <a href="http://jaskula.fr//blog/tag/fsharp/">f#</a>&nbsp;(8),                     <a href="http://jaskula.fr//blog/tag/functional-programming/">functional programming</a>&nbsp;(4),                     <a href="http://jaskula.fr//blog/tag/fp/">fp</a>&nbsp;(3),                     <a href="http://jaskula.fr//blog/tag/algorithms/">algorithms</a>&nbsp;(2),                     <a href="http://jaskula.fr//blog/tag/graphs/">graphs</a>&nbsp;(1),                     <a href="http://jaskula.fr//blog/tag/data-structures/">data structures</a>&nbsp;(1),                     <a href="http://jaskula.fr//blog/tag/priority-queue/">priority queue</a>&nbsp;(1),                     <a href="http://jaskula.fr//blog/tag/binary-heap/">binary heap</a>&nbsp;(1),                     <a href="http://jaskula.fr//blog/tag/dijkstra-shortest-path/">dijkstra shortest path</a>&nbsp;(1)                  </p>

                  <h4>Blog archives</h4>
                    <a href="http://jaskula.fr//blog/archive/december-2016/index.html">
                      December 2016 (1)</a>,                    <a href="http://jaskula.fr//blog/archive/november-2016/index.html">
                      November 2016 (1)</a>,                    <a href="http://jaskula.fr//blog/archive/december-2015/index.html">
                      December 2015 (1)</a>,                    <a href="http://jaskula.fr//blog/archive/august-2015/index.html">
                      August 2015 (1)</a>,                    <a href="http://jaskula.fr//blog/archive/january-2015/index.html">
                      January 2015 (2)</a>,                    <a href="http://jaskula.fr//blog/archive/august-2013/index.html">
                      August 2013 (4)</a>,                    <a href="http://jaskula.fr//blog/archive/july-2013/index.html">
                      July 2013 (1)</a>,                    <a href="http://jaskula.fr//blog/archive/october-2012/index.html">
                      October 2012 (1)</a>,                    <a href="http://jaskula.fr//blog/archive/april-2012/index.html">
                      April 2012 (1)</a>,                    <a href="http://jaskula.fr//blog/archive/march-2012/index.html">
                      March 2012 (1)</a>,
              </article>
        </aside>
      </div>
    </div>

      <footer class="bottom">
          <div class="container">
              <div class="row">
                  <div class="col-lg-12">
                      <p>This site is generated using <a href="https://github.com/fsprojects/FsBlog">FsBlog</a> and hosted on <a href="https://github.com/tjaskula/Blog">GitHub</a></p>
                      <p><small>By Tomasz Jaskula, 2015 &mdash; Theme by <a href="https://github.com/matjas">matjas</a></small></p>
                  </div>
              </div>
          </div>

      </footer>

    <script src="http://jaskula.fr//javascripts/scale.fix.js"></script>
  </body>
</html>